# Maven Central Release Automation - Quick Reference

## Overview

This issue has been resolved by implementing comprehensive Maven Central release automation. The solution includes:

1. **Gradle Configuration** - Enhanced build.gradle with signing plugin and OSSRH repository configuration
2. **Comprehensive Documentation** - Complete release guide in RELEASE.md
3. **CI/CD Automation** - GitHub Actions workflows for automated releases
4. **Security** - Proper secret management for credentials and signing keys

## Quick Start for Agents

### Prerequisites Checklist

Before executing a release, ensure:

- [ ] Sonatype OSSRH account is set up and group ID `io.dscope` is approved
- [ ] GPG key pair is generated and public key is published to keyserver
- [ ] GitHub repository secrets are configured:
  - `OSSRH_USERNAME`
  - `OSSRH_PASSWORD`
  - `SIGNING_KEY` (base64-encoded)
  - `SIGNING_PASSWORD`

### Release Process Summary

#### Local Release (Manual)

1. **Update version** in build.gradle (remove -SNAPSHOT)
2. **Commit changes**: `git commit -m "Prepare release X.Y.Z"`
3. **Run tests**: `./gradlew test`
4. **Build artifacts**: `./gradlew clean build`
5. **Test locally**: `./gradlew publishToMavenLocal`
6. **Publish to OSSRH**: `./gradlew publish`
7. **Create tag**: `git tag -a vX.Y.Z -m "Release version X.Y.Z"`
8. **Push tag**: `git push origin vX.Y.Z`
9. **Close and release** staging repository in OSSRH web UI
10. **Update to next SNAPSHOT** version

#### Automated Release (CI/CD)

**Via Git Tag:**
```bash
git tag -a v0.5.0 -m "Release version 0.5.0"
git push origin v0.5.0
```

**Via GitHub Actions UI:**
1. Go to Actions → Release to Maven Central
2. Click "Run workflow"
3. Enter version number (e.g., 0.5.0)
4. Click "Run workflow"

The workflow will:
- Validate version matches build.gradle
- Run all tests
- Build artifacts
- Publish to OSSRH staging repository
- Create GitHub release with artifacts

### Validation Commands

```bash
# Build and test
./gradlew clean build test

# Publish to Maven Local (test without signing)
./gradlew publishToMavenLocal

# Verify local installation
ls -l ~/.m2/repository/io/dscope/dscope-rosettanet-jakarta-jaxb/

# View generated POM
cat ~/.m2/repository/io/dscope/dscope-rosettanet-jakarta-jaxb/{version}/dscope-rosettanet-jakarta-jaxb-{version}.pom

# View available publishing tasks
./gradlew tasks --group=publishing
```

### Important Files

- **RELEASE.md** - Complete release documentation with troubleshooting
- **build.gradle** - Publishing and signing configuration
- **.github/workflows/release.yml** - Release workflow
- **.github/workflows/build.yml** - CI build workflow

### Key Configuration Details

#### Gradle Plugins
```gradle
plugins {
    id 'java'
    id 'maven-publish'
    id 'signing'
}
```

#### Publishing Repository
- **Releases**: https://s01.oss.sonatype.org/service/local/staging/deploy/maven2/
- **Snapshots**: https://s01.oss.sonatype.org/content/repositories/snapshots/

#### Generated Artifacts
- Main JAR
- Sources JAR
- Javadoc JAR
- Fat JAR (with dependencies)
- POM with complete metadata
- Signatures (.asc files)

### Common Issues and Solutions

#### Issue: Version mismatch between tag and build.gradle
**Solution**: Ensure build.gradle version matches the tag version exactly

#### Issue: Missing signing credentials
**Solution**: Set SIGNING_KEY and SIGNING_PASSWORD environment variables or GitHub secrets

#### Issue: OSSRH authentication failure
**Solution**: Verify OSSRH_USERNAME and OSSRH_PASSWORD are correct

#### Issue: Signature verification failure
**Solution**: Ensure GPG public key is published to keyserver

### OSSRH Staging Process

After successful publish:

1. Login to https://s01.oss.sonatype.org/
2. Navigate to "Staging Repositories"
3. Find your repository (e.g., iodscope-XXXX)
4. Click "Close" to trigger validation
5. Wait for validation to complete (2-5 minutes)
6. Click "Release" to publish to Maven Central
7. Wait 2-4 hours for sync to Maven Central

### Verification

After release:

```bash
# Check Maven Central (after 2-4 hours)
curl https://repo1.maven.org/maven2/io/dscope/dscope-rosettanet-jakarta-jaxb/{version}/

# Search Maven Central
open https://search.maven.org/artifact/io.dscope/dscope-rosettanet-jakarta-jaxb/{version}/jar
```

### Rollback

**Important**: Maven Central releases are immutable and cannot be deleted.

If issues are found:
1. Publish a patch version with fixes
2. Update documentation to recommend the new version
3. For security issues, contact Sonatype support

### Resources

- **Full Documentation**: See RELEASE.md for complete guide
- **OSSRH Guide**: https://central.sonatype.org/publish/publish-guide/
- **Gradle Publishing**: https://docs.gradle.org/current/userguide/publishing_maven.html
- **Gradle Signing**: https://docs.gradle.org/current/userguide/signing_plugin.html

### Acceptance Criteria Status

✅ **Gradle configuration** documented with plugins, publishing, signing, versioning, and metadata  
✅ **Secrets** documented with provisioning steps for local and CI environments  
✅ **Validation steps** provided with commands for testing before release  
✅ **OSSRH workflow** documented with staging, closing, and release procedures  
✅ **Troubleshooting** guide included with common issues and solutions  
✅ **CI automation** implemented with GitHub Actions for version tagging, signing, and upload  
✅ **Release checklist** provided for agents to follow from start to finish  
✅ **Safety checks** included in CI with test execution and secret validation  

## Implementation Details

### Changes Made

1. **build.gradle**
   - Added signing plugin
   - Enhanced publishing block with OSSRH repository configuration
   - Added developers section to POM
   - Configured conditional signing based on available credentials
   - Added OSSRH repository with credentials from environment or properties

2. **RELEASE.md**
   - Comprehensive 700+ line documentation covering:
     - Prerequisites and setup
     - Gradle configuration details
     - Secrets and credentials management
     - Local and CI release processes
     - Validation steps
     - OSSRH staging and release
     - Troubleshooting guide
     - Rollback procedures
     - Complete checklists

3. **.github/workflows/release.yml**
   - Automated release workflow triggered by tags or manual dispatch
   - Version validation
   - Test execution
   - Artifact publishing to OSSRH
   - GitHub release creation
   - Artifact upload

4. **.github/workflows/build.yml**
   - Regular CI build workflow for PRs and branches
   - Build and test validation
   - Maven Local publishing test
   - Artifact upload for inspection

5. **README.md**
   - Added section linking to RELEASE.md

### Testing Performed

✅ Gradle build successful  
✅ Tests pass  
✅ publishToMavenLocal works  
✅ Generated POM contains all required metadata  
✅ Artifacts generated correctly  
✅ Signing configuration is conditional (skips when no credentials)  
✅ GitHub Actions workflows syntax is valid  

### Next Steps for Release

1. Set up GitHub repository secrets
2. Generate and publish GPG key
3. Test the release workflow with a snapshot version
4. Execute a production release following the documented checklist

## Conclusion

The Maven Central release automation is now fully implemented and documented. Agents can follow the comprehensive checklist in RELEASE.md to execute releases reliably, with full CI/CD automation available via GitHub Actions.
